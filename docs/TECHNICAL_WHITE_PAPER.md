# Technical White Paper: tf-trend Systematic Managed Futures Platform

Prepared by Engineer Investor ([@egr_investor](https://x.com/egr_investor)).

## Abstract
The `tf-trend` package delivers a modular research and backtesting stack for systematic trend-following strategies across global futures markets. Version 0.9.0 consolidates APIs, command line workflows, and reporting pipelines that enable reproducible experiments, institutional-grade analytics, and extensibility for new asset classes or trading logic.【F:tf_trend_repo/src/tf/__init__.py†L1-L36】 This white paper documents the technical architecture, detailing the data engineering layer, signal generation, portfolio construction, execution simulation, research workflows, and evaluation outputs that collectively support production-quality managed futures research.

## 1. System Overview
At its core, the platform orchestrates data ingestion, signal generation, risk-aware sizing, execution simulation, and analytics to deliver `BacktestResults` artefacts containing positions, trades, NAV, cost attribution, and metadata for downstream processing.【F:tf_trend_repo/src/tf/engine/backtester.py†L72-L88】【F:tf_trend_repo/src/tf/engine/backtester.py†L360-L626】 The package exposes a `BacktestContext` describing resolved configuration, universe definitions, generated price history, and reproducibility seeds so that notebook and CLI users can interrogate and persist experiment state.【F:tf_trend_repo/src/tf/api.py†L21-L159】 Parameter sweeps, walk-forward splits, and deterministic replays are first-class features, enabling comprehensive scenario management from both the API and CLI surfaces.【F:tf_trend_repo/src/tf/api.py†L200-L324】【F:tf_trend_repo/src/tf/cli.py†L201-L400】

## 2. Data Engineering Pipeline

### 2.1 Universe Metadata
Futures instruments are described via `ContractMetadata`, capturing sectors, point values, currency denomination, contract rounding increments, and data vendor routing so that downstream components can map between reporting conventions and external data identifiers.【F:tf_trend_repo/src/tf/data/metadata.py†L21-L112】 Collections of contracts form a validated `UniverseDefinition`, which can be exported as Pandas data frames or looked up by symbol to drive analytics and risk aggregation.【F:tf_trend_repo/src/tf/data/metadata.py†L115-L163】 Reference universes ship in YAML format with sector diversification and point-value scaling for core equity, rates, commodities, and FX contracts.【F:tf_trend_repo/configs/universe.yaml†L1-L9】

### 2.2 Market Data Acquisition
`load_prices_or_generate` accepts the universe definition, requested window, and vendor preference to retrieve historical settlements. The loader favours Yahoo! Finance, applies calendar validation, and enforces data-quality checks; if vendor data are unavailable or offline, it falls back to reproducible synthetic series seeded by user configuration.【F:tf_trend_repo/src/tf/data/ingest.py†L27-L97】 Vendor-specific helpers support Yahoo! futures tickers as well as local CSV/Parquet imports with column inference and schema validation, enabling seamless integration with proprietary datasets.【F:tf_trend_repo/src/tf/data/ingest.py†L100-L243】 Synthetic generators produce regime-switching random walks with mild trends, ensuring deterministic behaviour for testing and documentation examples.【F:tf_trend_repo/src/tf/data/synthetic.py†L1-L19】

### 2.3 Calendars, Validation, and Continuity
A lightweight `TradingCalendar` aligns raw prices to business-day schedules, optionally excluding custom holiday sets while enforcing monotonic, duplicate-free indices.【F:tf_trend_repo/src/tf/data/calendar.py†L25-L68】 Validation utilities flag non-positive prices, duplicated timestamps, and excessive missing spans while also detecting exchange suspensions or limit moves for diagnostics.【F:tf_trend_repo/src/tf/data/validators.py†L10-L134】 For contract-level datasets, continuous series builders support back-adjusted, ratio-adjusted, and return-stitched methodologies based on user-supplied roll schedules, providing transparent logic for analytical price continuity.【F:tf_trend_repo/src/tf/data/continuous.py†L1-L154】

## 3. Research Signal Library
The signal layer includes multi-horizon time-series momentum that combines volatility-weighted lookbacks with configurable signal lags and guardrails to standardise strength across instruments.【F:tf_trend_repo/src/tf/signals/momentum.py†L13-L40】 Additional modules deliver Donchian channel breakouts and moving-average crossovers, each normalised to bounded strengths and lagged to avoid look-ahead bias.【F:tf_trend_repo/src/tf/signals/breakout.py†L11-L28】【F:tf_trend_repo/src/tf/signals/moving_average.py†L10-L48】 Shared utilities provide rolling z-scores, configurable saturation functions (tanh or linear), and NA handling to ensure signals remain within [-1, 1] regardless of raw indicator scaling.【F:tf_trend_repo/src/tf/signals/normalizers.py†L9-L66】

## 4. Risk Models and Portfolio Construction
Volatility estimators include exponentially weighted moving averages (EWMA), fixed-window realised volatility, and average true range computations—all capable of annualisation and minimum-period enforcement for stable sizing inputs.【F:tf_trend_repo/src/tf/risk/vol.py†L9-L70】 Portfolio construction uses volatility targeting with optional equal risk contribution budgets, sector caps, gross exposure clamps, and per-instrument contract rounding to translate signal strength into executable contracts under realistic trading frictions.【F:tf_trend_repo/src/tf/portfolio/sizing.py†L13-L204】 Rebalance thresholds prevent unnecessary churn by anchoring small adjustments to previous positions, while user-supplied volatility matrices or allocator overrides can be merged seamlessly into the sizing workflow.【F:tf_trend_repo/src/tf/portfolio/sizing.py†L94-L204】

## 5. Execution and Transaction Cost Modelling
The execution engine queues `Order` objects tagged by rebalance or roll rationale, and a `RollEngine` emits paired exit/entry orders based on user-provided roll schedules to simulate contract transitions.【F:tf_trend_repo/src/tf/engine/execution.py†L11-L55】 Average daily volume (ADV) data can be provided per instrument, per day, or as a constant; the simulator aligns these series to the trading calendar to enforce participation caps.【F:tf_trend_repo/src/tf/engine/execution.py†L58-L79】 A participation-style slippage model scales tick costs with order size relative to ADV while respecting minimum tick assumptions, and fixed per-contract commissions capture explicit fees.【F:tf_trend_repo/src/tf/engine/execution.py†L81-L101】【F:tf_trend_repo/src/tf/engine/backtester.py†L345-L359】

## 6. Backtesting Engine
`Backtester` composes price data, universe metadata, and configuration overrides to simulate daily trading over arbitrary windows. It supports nested parameter overrides, walk-forward splits, reproducibility checks via deterministic seeds, and optional parallel execution through Joblib.【F:tf_trend_repo/src/tf/engine/backtester.py†L26-L229】【F:tf_trend_repo/src/tf/engine/backtester.py†L284-L307】 During simulation, signals and volatility-target positions are computed ahead of the event loop, ADV limits throttle order fills, and transaction costs are tracked separately for trading versus rolling activity.【F:tf_trend_repo/src/tf/engine/backtester.py†L360-L626】 Resulting artefacts include NAV, positions, trades with slippage/commission attribution, ledger rows, and cached price/metadata used for downstream analytics.【F:tf_trend_repo/src/tf/engine/backtester.py†L360-L626】

## 7. Research Workflow Toolkit
High-level APIs create `BacktestContext` objects, merge override dictionaries, and prepare backtesters while abstracting price generation, universe loading, and seed management from notebook users.【F:tf_trend_repo/src/tf/api.py†L21-L193】 Parameter sweeps serialise scenario metadata, iterate grids with independent seeds, and return structured `ParameterSweepResult` objects for comparative analysis.【F:tf_trend_repo/src/tf/api.py†L200-L324】 Walk-forward utilities define training/testing windows, compute in-sample and out-of-sample summaries, and translate window definitions into backtester overrides for seamless cross-validation workflows.【F:tf_trend_repo/src/tf/research/walkforward.py†L16-L134】 Monte Carlo helpers perform moving-block bootstrap resampling to estimate Sharpe and drawdown confidence intervals, providing robustness diagnostics for backtest return streams.【F:tf_trend_repo/src/tf/research/monte_carlo.py†L14-L114】 Sensitivity analysis routines sweep arbitrary dotted-parameter paths (e.g., momentum lookbacks or volatility targets) and aggregate metric responses to visualise performance surfaces.【F:tf_trend_repo/src/tf/research/sensitivity.py†L13-L102】 Command-line interfaces mirror these capabilities with `run`, `report`, `sweep`, and `walkforward` subcommands that manage overrides, seeds, parallelism, and artefact export directories for reproducible automation.【F:tf_trend_repo/src/tf/cli.py†L201-L400】

## 8. Evaluation, Attribution, and Reporting
Evaluation modules compute instrument-level PnL contributions using lagged positions and point-value scaling, aggregate sector contributions, derive exposure timeseries, and reconcile trading versus roll costs from both ledger and trade logs.【F:tf_trend_repo/src/tf/eval/analytics.py†L10-L102】 Performance summaries annualise returns and volatility, report risk-adjusted ratios, drawdowns, higher moments, turnover, and hit rates, while rolling metrics track volatility and Sharpe through time for stability analysis.【F:tf_trend_repo/src/tf/eval/metrics.py†L11-L124】 Reporting utilities persist metrics to JSON/CSV/Parquet, render HTML dashboards with tables and charts, and generate companion PDF reports composed from the saved visualisations.【F:tf_trend_repo/src/tf/cli.py†L86-L198】【F:tf_trend_repo/src/tf/report/exporter.py†L14-L152】 Plotting helpers standardise the look-and-feel of equity curves, drawdowns, rolling statistics, contribution breakdowns, exposures, distribution histograms, correlation heatmaps, and sensitivity curves for institutional-quality presentation packs.【F:tf_trend_repo/src/tf/report/plots.py†L11-L191】

## 9. Configuration and Run Management
Baseline configurations encode data roots, roll methodology, universe file paths, signal parameters, risk budgets, execution cost assumptions, and backtest windows; these YAML files serve as versionable experiment blueprints that can be overridden programmatically or via CLI flags.【F:tf_trend_repo/configs/base.yaml†L1-L47】 Run directories inherit from the configured `results_dir`, storing NAV, trades, summaries, charts, and sweep metadata, which facilitates audit trails and comparison across scenarios.【F:tf_trend_repo/src/tf/api.py†L21-L159】【F:tf_trend_repo/src/tf/cli.py†L80-L198】

## 10. Extensibility Considerations
The modular layout—separating data adapters, signal modules, sizing policies, execution models, analytics, and reporting—allows practitioners to introduce alternative indicators, custom risk models, or proprietary cost curves by swapping implementations in their respective namespaces. Configuration overrides and the dotted-parameter grid expansion enable rapid experimentation without modifying source code, ensuring the platform remains adaptable to evolving investment mandates and new datasets.【F:tf_trend_repo/src/tf/engine/backtester.py†L26-L229】【F:tf_trend_repo/src/tf/api.py†L200-L324】

## Conclusion
`tf-trend` integrates robust data engineering, signal research, portfolio analytics, execution realism, and rich reporting into a cohesive managed futures research environment. Through deterministic data generation, vendor fallbacks, and comprehensive tooling for sweeps, walk-forwards, bootstraps, and sensitivity studies, the platform provides a reproducible foundation for institutional systematic trend-following development and evaluation.【F:tf_trend_repo/src/tf/data/ingest.py†L27-L243】【F:tf_trend_repo/src/tf/engine/backtester.py†L360-L626】【F:tf_trend_repo/src/tf/research/walkforward.py†L16-L134】
